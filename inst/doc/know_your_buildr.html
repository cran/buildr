<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Know your {buildr}</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>







<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Know your {buildr}</h1>



<p>This vignette extends what <code>README</code> or
<code>{buildr}</code> homepage already briefly described. There is also
<a href="https://netique.github.io/buildr/articles/know_your_buildr.html">version
with <strong>animated examples</strong></a>. After reading it, you’ll be
familiar with:</p>
<ul>
<li>how to work with <code>{buildr}</code> using your own keyboard
shortcuts</li>
<li>how <code>{buildr}</code> works under the hood</li>
<li>what is a <code>Makefile</code> and how <code>{buildr}</code> uses
it</li>
<li>tips for some advanced usage</li>
</ul>
<div id="buildr-rstudio" class="section level2">
<h2><code>{buildr}</code> + RStudio = ❤️</h2>
<p>It’s easy to work with <code>{buildr}</code> by printing function
calls in your <code>R</code> console. However, much more feasible is to
use <code>{buildr}</code> as RStudio Addin, which plays nicely with
keyboard shortcuts, adding to the comfort. <code>{buildr}</code> addin
commands are available below your toolbar in RStudio just upon the
installation.</p>
<blockquote>
<p>Well, that’s pretty neat, but my time is precious and I don’t mean to
spend it by clicking around that tiny toolbar.</p>
</blockquote>
<p>Likewise! Here come the keyboard shortcuts. The quickest way how to
set them up is to use <code>buildr::edit_shortcuts()</code>.</p>
<p>Note that all three functions are supported as addin commands. If you
stick with recommended defaults, there is no need to use anything else.
The only function that may need a richer user input is
<code>init()</code>. Let’s describe it in more detail.</p>
</div>
<div id="lets-see-what-you-got-there" class="section level2">
<h2>Let’s see what you got there</h2>
<p>The <code>init()</code> function should be called first (and only
occasionally afterwards). It searches your project root (the directory
where your <code>.Rproj</code> file resides) and looks for
<code>.R</code> scripts that shares a common prefix separated from the
rest of a file name by a separator (“build” and “_” by default,
respectively). Although it is possible to use different prefix and
separator, we recommend that you stick with the default. For more
details, please see the reference (documentation) for the
<code>init()</code> function.</p>
<p>Those “build scripts” can do really anything, that’s up to you.
Commonly, they share the following:</p>
<ol style="list-style-type: decimal">
<li>loading of libraries</li>
<li>sourcing some <code>.R</code> scripts, e.g.,
<code>source(&quot;run_this.R&quot;, encoding = &quot;UTF-8&quot;, local = TRUE)</code>,
which can do a bunch of things, like:</li>
</ol>
<ul>
<li>downloading any remote data</li>
<li>cleaning them</li>
<li>estimating some “heavier” models, saving their output</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>finally, you’d typically include some <code>{rmarkdown}</code> call,
say <code>rmarkdown::render(&quot;my_report.Rmd&quot;)</code></li>
</ol>
</div>
<div id="line-up-your-bricks" class="section level2">
<h2>Line up your bricks</h2>
<p>Once the <code>{buildr}</code> discovered your build scripts, it
automatically creates a <code>Makefile</code> in your project root for
you and populates it with rules describing how to run your build
scripts. Let’s make a little detour and talk more about
<code>Makefile</code>s more (<strong>you can skip this section if you
just want to use the package and do your stuff</strong>).</p>
<pre><code>target:
  recipe</code></pre>
<p>A target is usually a file name, but in our case, it is an arbitrary
string uniquely identifying given <code>Makefile</code> rule. A recipe
consists of a command describing what to do. In our case, we want to
source a <code>.R</code> script, say <code>build_all.R</code>, so our
rule would look like this:</p>
<pre><code>all:
  @Rscript -e &#39;source(&quot;build_all.R&quot;)&#39;</code></pre>
<p>The target of our rule is “all” and the recipe instructs the computer
to quietly (hence the <code>@</code>) start <code>R</code> and source
the script “build_all.R”, which resides in your project root. Note that
<code>Makefile</code>s are whitespace sensitive. A tab must always
precede the beginning of the recipe. <strong>Again, you don’t have to
bother with any of this, as the <code>{buildr}</code> does everything
for you.</strong></p>
<p>Now you may wonder why this section is called “Line up your bricks”?
That’s simple. The purpose of <code>aim()</code> is to line up the
<code>Makefile</code> rules in a particular order because the Rstudio
Build pane always takes the first rule available (in fact, you can
specify the target manually, but it is buried deep inside the GUI). The
goal of <code>aim()</code> is to list your <code>Makefile</code> rules
and show them so that you can pick the one you are interested in
(i.e. to prioritize it). Your choice then projects in the actual
<code>Makefile</code> – the desired rule is in the first place. That’s
what <code>aim()</code> does. In case you already know the target of a
given rule, you can just supply it directly in the call like this:
<code>aim(target = &quot;all&quot;)</code> or even simpler
<code>aim(&quot;all&quot;)</code>.</p>
</div>
<div id="build" class="section level2">
<h2>Build</h2>
<p>Now that everything is set-up, your only task is to call
<code>build()</code>. Under the hood, <code>{buildr}</code> makes sure
that RStudio is set appropriately to handle the <code>Makefile</code>.
RStudio Build pane may be set for building packages or websites, so it
is crucial to ensure your script is run nice and clean. In case
something is wrong, <code>{buildr}</code> automatically offers you a
remedy.</p>
</div>
<div id="whats-next" class="section level2">
<h2>What’s next?</h2>
<p>If you’ve already dived into the documentation of the package, you
might still wonder what is the purpose of <code>command_args</code>
argument of <code>init()</code>. When the build script is processed in
RStudio Build pane, the recipe may be accompanied by so-called “command
argument”. This argument can be picked up by <code>R</code> and used in
your build script to further specify how it should be run. In order to
use it, state your command argument when you initialize the
<code>Makefile</code> using
<code>init(command_arg = &quot;my_argument&quot;)</code> or manually. Note that
the command argument will be placed after <em>each</em> rule’s recipe.
In future updates, this may accommodate a vector of command arguments,
but there are many things to solve yet. Then, include the following line
to your script:</p>
<pre><code>command_args &lt;- commandArgs(trailingOnly = TRUE)
</code></pre>
<p>The object <code>command_args</code> that you’ve created by the
assignment will comprise the command argument stated in
<code>Makefile</code> when it is run, and you can further use it inside
your script. E.g., you can query whether specific command argument was
passed by
<code>if (&quot;my_arg&quot; %in% command_args) {print(&quot;Yes&quot;)} else {print(&quot;No&quot;)}</code>.</p>
</div>
<div id="i-want-more-complexity" class="section level2">
<h2>I want more complexity!</h2>
<p>The <code>{buildr}</code> was made with simplicity in mind. It helps
you bind a given script with a single keystroke using only a handful of
functions. The content of such script is completely up to you. What you
code is what you get.</p>
<p>However, if you don’t mind delving a bit into new and slightly
complicated things, I warmly recommend you to take a look at <a href="https://docs.ropensci.org/drake/">drake</a> package or at its
successor, <a href="https://github.com/ropensci/targets/">targets</a>.</p>
<p>And as always, happy building!</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
